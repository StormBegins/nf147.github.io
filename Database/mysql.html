<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-09-10 Mon 00:30 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MySQL</title>
<meta name="generator" content="Org mode">
<meta name="author" content="某某人">
<link rel='stylesheet' href='/asset/common.css' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/asset/common.js'></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">MySQL</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2e4c3fc">1. 安装与配置</a></li>
<li><a href="#orgef7e074">2. 数据库与账户</a></li>
<li><a href="#org03d51a7">3. 用户跟权限</a></li>
<li><a href="#org6ab6e50">4. 基本命令</a></li>
<li><a href="#orgf0f64f7">5. 创建表</a></li>
<li><a href="#org0ef7199">6. 数据类型</a></li>
<li><a href="#org77663c8">7. 主键</a></li>
<li><a href="#org5f9cd3d">8. 表的修改的语法</a></li>
<li><a href="#orgd5aa2aa">9. 其他命令</a></li>
<li><a href="#orge426756">10. 存储过程</a></li>
<li><a href="#orgd22562b">11. 查询练习</a></li>
</ul>
</div>
</nav>



<section id="outline-container-org2e4c3fc" class="outline-2">
<h2 id="org2e4c3fc"><span class="section-number-2">1</span> 安装与配置</h2>
<div class="outline-text-2" id="text-1">
<p>
MySQL/MariaDB:
</p>
<ul class="org-ul">
<li><a href="https://www.mysql.com/cn/">https://www.mysql.com/cn/</a></li>
<li><a href="http://mariadb.org">http://mariadb.org</a></li>
</ul>

<p>
比如，MariaDB 的下载页面:
</p>
<ul class="org-ul">
<li><a href="https://downloads.mariadb.org/mariadb/10.3.9/">https://downloads.mariadb.org/mariadb/10.3.9/</a></li>
</ul>

<p>
下载安装即可：
</p>
<ul class="org-ul">
<li>注意，要注意勾选“将utf8作为默认字符集”</li>
<li>安装过程中需要提供 root 用户的密码，需要记住</li>
<li>安装完后，需要将 bin 目录添加到环境变量中</li>
<li>可以选择将 mysqld 安装为 windows 服务，如果没有勾选，那么也可以手动创建服务</li>
</ul>

<p>
创建服务的方式:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">&#22914;&#26524;&#35201;&#21024;&#38500;&#30456;&#20851;&#26381;&#21153;&#65292;&#21482;&#38656;&#35201;&#22312;&#8220;&#31649;&#29702;&#21592;&#36523;&#20221;&#8221;&#30340;&#21629;&#20196;&#34892;&#31383;&#21475;&#19979;&#38754;&#36816;&#34892;:</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">sc delete &#26381;&#21153;&#21517;&#23383;</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">&#23558; MySQL &#23433;&#35013;&#20026;&#26381;&#21153;&#30340;&#26041;&#24335;:</span>
<span class="org-string">"C:\Program Files\MariaDB 10.3\bin\mysqld.exe"</span> install MyDB --defaults-file=<span class="org-string">"C:\Program Files\MariaDB 10.3\my.ini"</span>
</pre>
</div>

<p>
在连接之前，需要启动服务器守护程序，可以通过下面两种方式之一:
</p>
<ol class="org-ol">
<li>启动相关 windows 服务，比如 MySQL 服务</li>
<li>通过命令行窗口，执行 <code>mysqld --defaults-file=my.ini</code> 命令</li>
</ol>

<p>
服务启动后，就可以通过客户端访问了:
</p>
<div class="org-src-container">
<pre class="src src-sh">mysql -u root -p
mysql -uroot -proot
mysql -h 45.42.32.1 -P 9999 -uroot -p
</pre>
</div>
</div>
</section>

<section id="outline-container-orgef7e074" class="outline-2">
<h2 id="orgef7e074"><span class="section-number-2">2</span> 数据库与账户</h2>
<div class="outline-text-2" id="text-2">
<p>
MySQL 在用户登录后（默认使用 root 用户登录），需要切换到一个 <b>database</b> 才能进行表的创建等操作。所有的表和数据都隶属于某个数据库。
</p>

<p>
刚安装完之后，MySQL 中有若干内置数据库：
</p>


<figure>
<img src="img/clip_2018-09-05_07-24-23.png" alt="clip_2018-09-05_07-24-23.png">

</figure>

<p>
想要切换到某个数据库下，使用 <code>use</code> 指令:
</p>
<pre class="example">
use mysql
</pre>

<p>
我们可以为自己的业务创建单独的数据库，比如，为我们的书店项目我们创建一个单独的数据库:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> database bookstore;
<span class="org-keyword">create</span> database bookstore <span class="org-type">character</span> <span class="org-keyword">set</span> UTF8; <span class="org-comment">-- &#21019;&#24314;&#26102;&#21487;&#20197;&#25351;&#23450;&#23383;&#31526;&#38598;</span>
use bookstore;  <span class="org-comment">-- &#20999;&#25442;&#21040;&#25968;&#25454;&#24211;&#19979;</span>
</pre>
</div>

<p>
虽然 root 用户强大无比，但是使用 root 用户进行数据库操作不是一个好的行为。所以我们需要为数据库的操作创建相关的用户:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-comment">-- &#29305;&#21035;&#38656;&#35201;&#27880;&#24847;&#65292;&#22312; MySQL &#20013;&#65292;&#36134;&#21495;&#30001;&#20004;&#37096;&#20998;&#32452;&#25104;:</span>
<span class="org-comment">-- 1. user</span>
<span class="org-comment">-- 2. host</span>
<span class="org-comment">-- &#21363;&#20351; user &#30456;&#21516;&#65292;&#21482;&#35201; host &#19981;&#21516;&#65292;&#20063;&#20250;&#34987;&#35748;&#20026;&#26159;&#19981;&#21516;&#36134;&#21495;&#12290;</span>
<span class="org-comment">-- &#36825;&#26679;&#21487;&#20197;&#38750;&#24120;&#26041;&#20415;&#23545;&#26469;&#33258;&#19981;&#21516; ip &#22320;&#22336;&#30340;&#35775;&#38382;&#36827;&#34892;&#31934;&#32454;&#30340;&#26435;&#38480;&#25511;&#21046;&#12290;</span>
<span class="org-comment">-- &#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#21019;&#24314;&#30340;&#29992;&#25143; host &#20026; '%'&#65292;&#36825;&#26159;&#19968;&#20010;&#21305;&#37197;&#31526;&#65292;&#36319;&#27169;&#31946;&#26597;&#35810;&#37324;&#30340;&#24847;&#24605;&#19968;&#26679;&#65292;&#34920;&#31034;&#21305;&#37197;&#25152;&#26377;</span>
<span class="org-keyword">create</span> <span class="org-builtin">user</span> vip identified <span class="org-keyword">by</span> <span class="org-string">'vippp'</span>;             <span class="org-comment">-- &#25152;&#26377;&#36830;&#25509;</span>
<span class="org-keyword">create</span> <span class="org-builtin">user</span> vip@<span class="org-string">'127.0.0.1'</span> identified <span class="org-keyword">by</span> <span class="org-string">'xxx'</span>;   <span class="org-comment">-- &#26412;&#22320;&#36830;&#25509;</span>
<span class="org-keyword">create</span> <span class="org-builtin">user</span> vip@<span class="org-string">'192.168.%'</span> identified <span class="org-keyword">by</span> <span class="org-string">'yyy'</span>;   <span class="org-comment">-- 192.168 &#32593;&#27573;&#30340;&#36830;&#25509;</span>
</pre>
</div>

<p>
新创建的用户没有多少权限，登录之后，只能访问操作 test 以及以 test 开头的数据库。如果想让新用户有更多权限，就需要用到授权语句(DCL)：
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">grant</span> <span class="org-keyword">all</span> <span class="org-keyword">on</span> *.* <span class="org-keyword">to</span> vip@<span class="org-string">'127.0.0.1'</span>;        <span class="org-comment">-- &#23558;&#25152;&#26377;&#25968;&#25454;&#24211;&#19978;&#30340;&#25152;&#26377;&#26435;&#21033;&#37117;&#25480;&#20104;&#36890;&#36807;&#26412;&#26426;&#36830;&#25509;&#30340; vip &#29992;&#25143;&#65281;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">all</span> <span class="org-keyword">privileges</span> <span class="org-keyword">on</span> lagou.* <span class="org-keyword">to</span> vip@<span class="org-string">'%'</span>; <span class="org-comment">-- &#23558;&#25968;&#25454;&#24211; lagou &#19978;&#30340;&#25152;&#26377;&#26435;&#21033;&#37117;&#25480;&#20104;&#25152;&#26377;&#36830;&#25509;&#30340; vip &#29992;&#25143;!</span>
<span class="org-keyword">grant</span> <span class="org-keyword">select</span> <span class="org-keyword">on</span> lagou.<span class="org-keyword">position</span> <span class="org-keyword">to</span> vip@<span class="org-string">'%'</span>;  <span class="org-comment">-- &#23558; lagou &#25968;&#25454;&#24211;&#19978;&#30340; position &#34920;&#30340;&#35775;&#38382;&#26435;&#38480;&#24320;&#25918;&#32473;&#25152;&#26377; vip &#29992;&#25143;&#12290;</span>
</pre>
</div>

<p>
如果想查看某个用户拥有的权限，只需要:
</p>
<div class="org-src-container">
<pre class="src src-sql">show grants <span class="org-keyword">for</span> vip@<span class="org-string">'%'</span>;
</pre>
</div>
</div>
</section>

<section id="outline-container-org03d51a7" class="outline-2">
<h2 id="org03d51a7"><span class="section-number-2">3</span> 用户跟权限</h2>
<div class="outline-text-2" id="text-3">
<p>
用户跟权限的相关信息，都是保存在下面表中：
</p>
<ul class="org-ul">
<li>mysql.user</li>
<li>mysql.db/host/table/priv&#x2026;</li>
</ul>

<p>
<code>mysql.user</code> 是一个非常重要非常特殊的表，它保存了所有的账号信息，以及保存了账号的权限信息。
</p>

<p>
如果要操作用户和权限，有两种方式:
</p>
<ol class="org-ol">
<li>使用相关的授权语句</li>
<li>直接修改 mysql.user 表</li>
</ol>

<p>
<b>第一种方式</b>:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-comment">-- &#26597;&#30475;&#29992;&#25143;</span>
<span class="org-keyword">select</span> <span class="org-builtin">current_user</span>(), <span class="org-builtin">user</span>();
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> mysql.<span class="org-builtin">user</span>;

<span class="org-comment">-- &#21019;&#24314;&#19982;&#25480;&#26435;</span>
<span class="org-keyword">create</span> <span class="org-builtin">user</span> <span class="org-string">'xxx'</span>@<span class="org-string">'host'</span> identified <span class="org-keyword">by</span> <span class="org-string">'&#23494;&#30721;'</span>;
<span class="org-keyword">grant</span> <span class="org-keyword">all</span> <span class="org-keyword">on</span> ttt.* <span class="org-keyword">to</span> <span class="org-string">'user'</span>@<span class="org-string">'host'</span> <span class="org-keyword">with</span> <span class="org-keyword">grant</span> <span class="org-keyword">options</span>;

<span class="org-comment">-- &#26597;&#30475;&#25480;&#26435;&#24773;&#20917;</span>
show grants <span class="org-keyword">for</span> <span class="org-string">'user'</span>@<span class="org-string">'host'</span>;

<span class="org-comment">-- &#29992;&#25143;&#30340;&#31649;&#29702;&#65292;&#21024;&#38500;&#23494;&#30721;&#31561;</span>
<span class="org-keyword">set</span> password <span class="org-keyword">for</span> <span class="org-string">'user'</span>@<span class="org-string">'host'</span> = password(<span class="org-string">'&#26032;&#23494;&#30721;'</span>);
<span class="org-keyword">drop</span> <span class="org-builtin">user</span> vip;

<span class="org-comment">-- &#25480;&#26435;&#30340;&#30456;&#23545;&#23436;&#25972;&#35821;&#27861;&#20026;:</span>
<span class="org-keyword">grant</span> <span class="org-keyword">all</span>/<span class="org-keyword">alter</span>/<span class="org-keyword">create</span>/<span class="org-keyword">drop</span>/<span class="org-keyword">select</span>/<span class="org-keyword">update</span>/<span class="org-keyword">delete</span>
      <span class="org-keyword">on</span> *.* <span class="org-comment">-- db.*/db.table</span>
      <span class="org-keyword">to</span> <span class="org-string">'user'</span>@<span class="org-string">'host'</span>
      identified <span class="org-keyword">by</span> <span class="org-string">'&#23494;&#30721;'</span>
      <span class="org-keyword">with</span> max_user_connections 2
           max_connections_pser_hour 5;
</pre>
</div>


<p>
<b>第二种方式</b>:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-comment">-- &#22686;&#21152;&#29992;&#25143;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> mysql.<span class="org-builtin">user</span>(<span class="org-keyword">host</span>, <span class="org-builtin">user</span>, password) <span class="org-keyword">values</span> (xx, yy, zz);

<span class="org-comment">-- &#20462;&#25913;&#23494;&#30721;</span>
<span class="org-keyword">update</span> mysql.<span class="org-builtin">user</span> <span class="org-keyword">set</span> password=password(<span class="org-string">'&#26032;&#23494;&#30721;'</span>) <span class="org-keyword">where</span> <span class="org-builtin">user</span>=<span class="org-string">'vip'</span> <span class="org-keyword">and</span> <span class="org-keyword">host</span>=<span class="org-string">'%'</span>;

<span class="org-comment">-- &#20462;&#25913;&#26435;&#38480;</span>
<span class="org-keyword">update</span> mysql.<span class="org-builtin">user</span> <span class="org-keyword">set</span> event_priv=<span class="org-string">'Y'</span> <span class="org-keyword">where</span> <span class="org-builtin">user</span>=<span class="org-string">'vip'</span> <span class="org-keyword">and</span> <span class="org-keyword">host</span>=<span class="org-string">'%'</span>;

<span class="org-comment">-- &#27880;&#24847;&#65292;&#20351;&#29992; sql &#35821;&#21477;&#20462;&#25913;&#29992;&#25143;&#36319;&#26435;&#38480;&#20043;&#21518;&#65292;&#38656;&#35201;&#25163;&#21160;&#21047;&#26032;&#26435;&#38480;&#34920;</span>
flush <span class="org-keyword">privileges</span>;
</pre>
</div>
</div>
</section>
<section id="outline-container-org6ab6e50" class="outline-2">
<h2 id="org6ab6e50"><span class="section-number-2">4</span> 基本命令</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">
<pre class="src src-sql"><span class="org-comment">-- &#26597;&#35810;&#24403;&#21069;&#26085;&#26399;</span>
<span class="org-keyword">select</span> now(), <span class="org-builtin">current_date</span>, <span class="org-builtin">current_time</span>;

<span class="org-comment">-- &#26597;&#35810;&#24403;&#21069;&#29992;&#25143;</span>
<span class="org-keyword">select</span> <span class="org-builtin">user</span>(), <span class="org-builtin">current_user</span>();

<span class="org-comment">-- &#25968;&#25454;&#24211;</span>
show databases;
use test;
</pre>
</div>
</div>
</section>

<section id="outline-container-orgf0f64f7" class="outline-2">
<h2 id="orgf0f64f7"><span class="section-number-2">5</span> 创建表</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">book1</span> (
   bookid <span class="org-type">int</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span>
);
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">book2</span> (
   bookid <span class="org-type">int</span>,
   <span class="org-keyword">primary</span> <span class="org-keyword">key</span> (bookid)
);
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">book3</span> (
   bookid <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>
);
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">book4</span> (
   bookid <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
   <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   price <span class="org-type">float</span> <span class="org-keyword">check</span> (price &gt;= 0)
);
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">book5</span> (
   bookid <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
   <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   price <span class="org-type">float</span> <span class="org-keyword">check</span> (price &gt;= 0),
   press <span class="org-type">varchar</span>(50),
   authorid <span class="org-type">int</span> <span class="org-keyword">references</span> author (authorid)
   <span class="org-comment">-- foreign  key(author) references author(authorid),</span>
);
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">book6</span> (
   bookid <span class="org-type">int</span> auto_increment,
   <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   price <span class="org-type">float</span> <span class="org-keyword">check</span> (price &gt;= 0),
   press <span class="org-type">varchar</span>(50),
   authorid <span class="org-type">int</span>,

   <span class="org-keyword">primary</span> <span class="org-keyword">key</span> (bookid),
   <span class="org-keyword">foreign</span> <span class="org-keyword">key</span> (authorid) <span class="org-keyword">references</span> author (authorid)
);
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">book7</span> (
   bookid <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
   <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   price <span class="org-type">float</span> <span class="org-keyword">check</span> (price &gt;= 0),
   press <span class="org-type">varchar</span>(50),
   authorid <span class="org-type">int</span>
);

<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">author</span> (
  authorid <span class="org-type">int</span> auto_increment,
  <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
  tel <span class="org-type">varchar</span>(20),
  birth <span class="org-type">date</span>,
  <span class="org-keyword">primary</span> <span class="org-keyword">key</span> (authorid)
);



<span class="org-comment">-- &#23454;&#38469;&#30340;&#23548;&#20837;&#24773;&#20917;&#65292;&#39318;&#20808;&#21019;&#24314;&#34920;&#65292;&#20808;&#19981;&#28155;&#21152;&#20219;&#20309;&#22806;&#38190;&#32422;&#26463;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">book</span> (
   bookid <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
   <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   price <span class="org-type">float</span> <span class="org-keyword">check</span> (price &gt;= 0),
   press <span class="org-type">varchar</span>(50),
   authorid <span class="org-type">int</span>,
   publish_at datetime,
   created_at <span class="org-type">timestamp</span>
);
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">author</span> (
  authorid <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
  <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
  tel <span class="org-type">varchar</span>(20),
  birth <span class="org-type">date</span>
);
<span class="org-comment">-- &#22312;&#36825;&#37324;&#65292;&#25191;&#34892;&#25152;&#26377;&#30340;&#25968;&#25454;&#25554;&#20837;&#25805;&#20316;</span>
<span class="org-comment">-- insert into book ...</span>
<span class="org-comment">-- insert into author ...</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">book</span> 
   <span class="org-keyword">add</span> <span class="org-keyword">constraint</span> fk_authorid
   <span class="org-keyword">foreign</span> <span class="org-keyword">key</span> (authorid)
   <span class="org-keyword">references</span> author (authorid);
<span class="org-comment">-- &#22914;&#26524;&#38656;&#35201;&#28155;&#21152;&#20027;&#38190;&#30340;&#35805;&#65292;&#35821;&#27861;&#22914;&#19979;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">book</span>
   <span class="org-keyword">add</span> <span class="org-keyword">constraint</span> pk_bookid
   <span class="org-keyword">primary</span> <span class="org-keyword">key</span> (bookid);
<span class="org-comment">-- &#22914;&#26524;&#24819;&#21024;&#38500;&#25481;&#30340;&#35805;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">book</span>
   <span class="org-keyword">drop</span> <span class="org-keyword">foreign</span> <span class="org-keyword">key</span> fk_authorid;
</pre>
</div>


<p>
其他:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">xxx</span> if <span class="org-keyword">not</span> <span class="org-keyword">exists</span> (id <span class="org-type">int</span>);

<span class="org-keyword">create</span> <span class="org-keyword">temporary</span> <span class="org-keyword">table</span> <span class="org-function-name">yyy</span> (id <span class="org-type">int</span>);

<span class="org-keyword">create</span> <span class="org-keyword">temporary</span> <span class="org-keyword">table</span> if <span class="org-keyword">not</span> <span class="org-keyword">exists</span> <span class="org-function-name">yyy</span> (
       id bigint auto_increment,
       <span class="org-keyword">name</span> <span class="org-type">varchar</span>(20) <span class="org-keyword">not</span> <span class="org-keyword">null</span> <span class="org-keyword">unique</span>, <span class="org-comment">-- &#21807;&#19968;&#65292;&#19981;&#37325;&#22797;&#30340;</span>
       birth datetime,
       gender enum(<span class="org-string">'f'</span>, <span class="org-string">'m'</span>), <span class="org-comment">-- Female Male</span>
       minzu <span class="org-keyword">set</span>(<span class="org-string">'&#27721;'</span>, <span class="org-string">'&#20420;&#32599;&#26031;'</span>),
       created_at <span class="org-type">timestamp</span>,
       <span class="org-keyword">primary</span> <span class="org-keyword">key</span> (id)
);


<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">aaa</span> (id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>, <span class="org-keyword">name</span> <span class="org-type">varchar</span>(20))
   <span class="org-keyword">default</span> charset = gbk
   engine = InnoDB
   auto_increment = 7
   comment = `&#36825;&#21482;&#26159;&#19968;&#20010;&#27979;&#35797;&#34920;&#32780;&#24050;`;

<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">gbk_test2</span> (vvv <span class="org-type">varchar</span>(4)) <span class="org-keyword">default</span> charset = gbk;
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">gbk_test3</span> (vvv <span class="org-type">varchar</span>(4)) <span class="org-keyword">default</span> charset = utf8;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> gbk_test2 <span class="org-keyword">values</span> (<span class="org-string">'&#20013;&#22269;'</span>);
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> gbk_test3 <span class="org-keyword">values</span> (<span class="org-string">'&#20013;&#22269;'</span>);
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> gbk_test2;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> gbk_test3;
<span class="org-keyword">select</span> <span class="org-keyword">length</span>(vvv) <span class="org-keyword">from</span> gbk_test2;
<span class="org-keyword">select</span> <span class="org-keyword">length</span>(vvv) <span class="org-keyword">from</span> gbk_test3;
<span class="org-keyword">select</span> <span class="org-builtin">char_length</span>(vvv) <span class="org-keyword">from</span> gbk_test2;
<span class="org-keyword">select</span> <span class="org-builtin">char_length</span>(vvv) <span class="org-keyword">from</span> gbk_test3;
</pre>
</div>

<p>
一致性，完整性
</p>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-left">名字</th>
<th scope="col" class="org-right">xxx</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">Java</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">太极剑法</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">MySQL指南</td>
<td class="org-right">22</td>
</tr>
</tbody>
</table>


<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-left">名字</th>
<th scope="col" class="org-left">生日</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">张三丰</td>
<td class="org-left">x</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">我</td>
<td class="org-left">y</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">你妹</td>
<td class="org-left">z</td>
</tr>
</tbody>
</table>
</div>
</section>

<section id="outline-container-org0ef7199" class="outline-2">
<h2 id="org0ef7199"><span class="section-number-2">6</span> 数据类型</h2>
<div class="outline-text-2" id="text-6">
<p>
大致分为 <b>6</b> 类:
</p>
<ol class="org-ol">
<li><b>整数</b>: bit / bool / tinyint / smallint / mediumint / int / bitint</li>
<li><b>浮点数</b>: float / double / decimal</li>
<li><b>字符串</b>: char / varchar / tinytext / text / mediumtext / longtext</li>
<li><b>BLOB(Binary Large Object)</b>: tinyblob / blob / mediumblob / longblob</li>
<li><b>日期</b>: date(2018-9-6) / time (03:33:49) / datetime(2018-9-6 03:34:08) / timestamp</li>
<li><b>其他</b>: binary / varbinary / enum / set / geometry / point / LineString &#x2026;</li>
</ol>

<p>
问题:
</p>
<ol class="org-ol">
<li>char 跟 varchar 有什么区别？</li>
<li>varchar 最多存储的长度是多少？</li>
<li>varchar 跟 text 类型有什么区别？</li>
<li>set/enum 该怎么去使用？</li>
</ol>

<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">char_demo</span> 
(
  aaa <span class="org-type">char</span>(40),
  bbb <span class="org-type">varchar</span>(40),
  ccc text(40)
);

<span class="org-keyword">insert</span> <span class="org-keyword">into</span> char_demo <span class="org-keyword">values</span> (<span class="org-string">'123'</span>, <span class="org-string">'123'</span>, <span class="org-string">'123'</span>);

<span class="org-keyword">select</span> <span class="org-keyword">length</span>(aaa), <span class="org-keyword">length</span>(bbb), <span class="org-keyword">length</span>(ccc) <span class="org-keyword">from</span> char_demo;

<span class="org-keyword">SET</span> sql_mode = <span class="org-string">'PAD_CHAR_TO_FULL_LENGTH'</span>;

<span class="org-keyword">select</span> <span class="org-keyword">length</span>(aaa), <span class="org-keyword">length</span>(bbb), <span class="org-keyword">length</span>(ccc) <span class="org-keyword">from</span> char_demo;
</pre>
</div>

<p>
总结 Char vs Varchar vs Text:
</p>
<ol class="org-ol">
<li>char(n) 和 varchar(n) 中间的 n 代表字符的个数，不是字节的个数</li>
<li>如果数据超过 n 的限制，那么数据将会被截断</li>
<li>char 是固定宽度，如果数据长度不满足 n，那么将会在右边用空格补齐；varchar 是变长宽度</li>
<li>varchar 是标准类型；text 不是标准类型</li>
<li>varchar 跟 text 都最大保存 65535 字节长度的数据。但是 text 还有 mediumtext/longtext 它可以支持存储更多的内容</li>
<li>varchar 的存储格式是 stored-inline, text 的存储格式是 off-record。一般情况来说，varchar 的速度要比 text 快</li>
</ol>

<p>
BLOB 类型，可以存储大字段。
</p>

<p>
ENUM 跟 SET 是两种比较特殊的字符串类型，他们对字段进行了一定约束:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> (
       id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
       <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
       gender <span class="org-type">char</span>(2) <span class="org-comment">-- &#38480;&#21046;&#65292;&#21482;&#26377; &#30007;&#12289;&#22899;&#12289;&#26410;&#30693;</span>
);


<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> (
       id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
       <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
       gender enum(<span class="org-string">'&#30007;'</span>, <span class="org-string">'&#22899;'</span>, <span class="org-string">'&#26410;&#30693;'</span>) <span class="org-comment">-- &#38480;&#21046;&#65292;&#21482;&#26377; &#30007;&#12289;&#22899;&#12289;&#26410;&#30693;</span>
);

<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person2</span> (
       id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
       <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30) <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
       gender enum(<span class="org-string">'&#30007;'</span>, <span class="org-string">'&#22899;'</span>, <span class="org-string">'&#26410;&#30693;'</span>), <span class="org-comment">-- &#38480;&#21046;&#65292;&#21482;&#26377; &#30007;&#12289;&#22899;&#12289;&#26410;&#30693;</span>
       country <span class="org-keyword">set</span>(<span class="org-string">'&#20013;&#22269;'</span>, <span class="org-string">'&#32654;&#22269;'</span>, <span class="org-string">'&#21335;&#38750;'</span>)
);

<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person3 (<span class="org-keyword">name</span>, gender, country) <span class="org-keyword">values</span> (<span class="org-string">'&#28781;&#32477;'</span>, <span class="org-string">'&#22899;'</span>, <span class="org-string">'&#32654;&#22269;,&#21335;&#38750;'</span>);
</pre>
</div>
</div>
</section>

<section id="outline-container-org77663c8" class="outline-2">
<h2 id="org77663c8"><span class="section-number-2">7</span> 主键</h2>
<div class="outline-text-2" id="text-7">
<p>
主键，primary key，从性能和实际出发，应该遵循下面几点:
</p>
<ol class="org-ol">
<li>尽量短，避免占用太多空间</li>
<li>唯一，不能跟其他行的数据重复</li>
<li>不会改变</li>
<li>代理键</li>
</ol>

<p>
所谓<b>代理键</b>是指跟业务无关的字段:
</p>
<ul class="org-ul">
<li>因为和业务无关，所以可以使用 int 等类型尽量短</li>
<li>因为和业务无关，所以可以避免因为业务变动引起的主键变化</li>
<li><b>不要相信自己的直觉，因为在直觉上感觉不会变的东西，往往都是经不起实践考验的</b></li>
</ul>
</div>
</section>

<section id="outline-container-org5f9cd3d" class="outline-2">
<h2 id="org5f9cd3d"><span class="section-number-2">8</span> 表的修改的语法</h2>
<div class="outline-text-2" id="text-8">
<p>
基本语法:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">ALTER</span> [ONLINE|OFFLINE] [<span class="org-keyword">IGNORE</span>] <span class="org-keyword">TABLE</span> tbl_name
    [alter_specification [, alter_specification] ...]
    [partition_options]

alter_specification:
    table_options
  | <span class="org-keyword">ADD</span> [<span class="org-keyword">COLUMN</span>] col_name column_definition
        [<span class="org-keyword">FIRST</span> | <span class="org-keyword">AFTER</span> col_name]
  | <span class="org-keyword">ADD</span> [<span class="org-keyword">COLUMN</span>] (col_name column_definition,...)

  | <span class="org-keyword">ADD</span> {INDEX|<span class="org-keyword">KEY</span>} [index_name]
        [index_type] (key_part,...) [index_option] ...
  | <span class="org-keyword">ADD</span> [<span class="org-keyword">CONSTRAINT</span> [symbol]] <span class="org-keyword">PRIMARY</span> <span class="org-keyword">KEY</span>
        [index_type] (key_part,...) [index_option] ...
  | <span class="org-keyword">ADD</span> [<span class="org-keyword">CONSTRAINT</span> [symbol]]
        <span class="org-keyword">UNIQUE</span> [INDEX|<span class="org-keyword">KEY</span>] [index_name]
        [index_type] (key_part,...) [index_option] ...
  | <span class="org-keyword">ADD</span> FULLTEXT [INDEX|<span class="org-keyword">KEY</span>] [index_name]
        (key_part,...) [index_option] ...
  | <span class="org-keyword">ADD</span> SPATIAL [INDEX|<span class="org-keyword">KEY</span>] [index_name]
        (key_part,...) [index_option] ...
  | <span class="org-keyword">ADD</span> [<span class="org-keyword">CONSTRAINT</span> [symbol]]
        <span class="org-keyword">FOREIGN</span> <span class="org-keyword">KEY</span> [index_name] (col_name,...)
        reference_definition
  | ALGORITHM [=] {<span class="org-keyword">DEFAULT</span>|INPLACE|COPY}
  | <span class="org-keyword">ALTER</span> [<span class="org-keyword">COLUMN</span>] col_name {<span class="org-keyword">SET</span> <span class="org-keyword">DEFAULT</span> literal | <span class="org-keyword">DROP</span> <span class="org-keyword">DEFAULT</span>}
  | CHANGE [<span class="org-keyword">COLUMN</span>] old_col_name new_col_name column_definition
        [<span class="org-keyword">FIRST</span>|<span class="org-keyword">AFTER</span> col_name]
  | [<span class="org-keyword">DEFAULT</span>] <span class="org-type">CHARACTER</span> <span class="org-keyword">SET</span> [=] charset_name [<span class="org-keyword">COLLATE</span> [=] <span class="org-keyword">collation_name</span>]
  | <span class="org-builtin">CONVERT</span> <span class="org-keyword">TO</span> <span class="org-type">CHARACTER</span> <span class="org-keyword">SET</span> charset_name [<span class="org-keyword">COLLATE</span> <span class="org-keyword">collation_name</span>]
  | {DISABLE|ENABLE} KEYS
  | {DISCARD|IMPORT} TABLESPACE

  | <span class="org-keyword">DROP</span> [<span class="org-keyword">COLUMN</span>] col_name
  | <span class="org-keyword">DROP</span> {INDEX|<span class="org-keyword">KEY</span>} index_name
  | <span class="org-keyword">DROP</span> <span class="org-keyword">PRIMARY</span> <span class="org-keyword">KEY</span>
  | <span class="org-keyword">DROP</span> <span class="org-keyword">FOREIGN</span> <span class="org-keyword">KEY</span> fk_symbol

  | FORCE
  | LOCK [=] {<span class="org-keyword">DEFAULT</span>|<span class="org-keyword">NONE</span>|SHARED|EXCLUSIVE}
  | <span class="org-keyword">MODIFY</span> [<span class="org-keyword">COLUMN</span>] col_name column_definition
        [<span class="org-keyword">FIRST</span> | <span class="org-keyword">AFTER</span> col_name]
  | <span class="org-keyword">ORDER</span> <span class="org-keyword">BY</span> col_name [, col_name] ...
  | RENAME [<span class="org-keyword">TO</span>|<span class="org-keyword">AS</span>] new_tbl_name
  | <span class="org-keyword">ADD</span> PARTITION (partition_definition)
  | <span class="org-keyword">DROP</span> PARTITION partition_names
  | TRUNCATE PARTITION {partition_names | <span class="org-keyword">ALL</span>}
  | <span class="org-builtin">COALESCE</span> PARTITION <span class="org-keyword">number</span>
  | REORGANIZE PARTITION partition_names <span class="org-keyword">INTO</span> (partition_definitions)
  | EXCHANGE PARTITION partition_name <span class="org-keyword">WITH</span> <span class="org-keyword">TABLE</span> tbl_name
  | ANALYZE PARTITION {partition_names | <span class="org-keyword">ALL</span>}
  | <span class="org-keyword">CHECK</span> PARTITION {partition_names | <span class="org-keyword">ALL</span>}
  | OPTIMIZE PARTITION {partition_names | <span class="org-keyword">ALL</span>}
  | REBUILD PARTITION {partition_names | <span class="org-keyword">ALL</span>}
  | REPAIR PARTITION {partition_names | <span class="org-keyword">ALL</span>}
  | REMOVE PARTITIONING

key_part:
    col_name [(<span class="org-keyword">length</span>)] [<span class="org-keyword">ASC</span> | <span class="org-keyword">DESC</span>]

index_type:
    <span class="org-keyword">USING</span> {BTREE | HASH}

index_option:
    KEY_BLOCK_SIZE [=] <span class="org-keyword">value</span>
  | index_type
  | <span class="org-keyword">WITH</span> PARSER parser_name
  | COMMENT <span class="org-string">'string'</span>

table_options:
    table_option [[,] table_option] ...

table_option:
    AUTO_INCREMENT [=] <span class="org-keyword">value</span>
  | AVG_ROW_LENGTH [=] <span class="org-keyword">value</span>
  | [<span class="org-keyword">DEFAULT</span>] <span class="org-type">CHARACTER</span> <span class="org-keyword">SET</span> [=] charset_name
  | CHECKSUM [=] {0 | 1}
  | [<span class="org-keyword">DEFAULT</span>] <span class="org-keyword">COLLATE</span> [=] <span class="org-keyword">collation_name</span>
  | COMMENT [=] <span class="org-string">'string'</span>
  | <span class="org-keyword">CONNECTION</span> [=] <span class="org-string">'connect_string'</span>
  | {<span class="org-keyword">DATA</span>|INDEX} DIRECTORY [=] <span class="org-string">'absolute path to directory'</span>
  | DELAY_KEY_WRITE [=] {0 | 1}
  | ENGINE [=] engine_name
  | INSERT_METHOD [=] { <span class="org-keyword">NO</span> | <span class="org-keyword">FIRST</span> | <span class="org-keyword">LAST</span> }
  | KEY_BLOCK_SIZE [=] <span class="org-keyword">value</span>
  | MAX_ROWS [=] <span class="org-keyword">value</span>
  | MIN_ROWS [=] <span class="org-keyword">value</span>
  | PACK_KEYS [=] {0 | 1 | <span class="org-keyword">DEFAULT</span>}
  | PASSWORD [=] <span class="org-string">'string'</span>
  | ROW_FORMAT [=] {<span class="org-keyword">DEFAULT</span>|<span class="org-keyword">DYNAMIC</span>|FIXED|COMPRESSED|REDUNDANT|COMPACT}
  | STATS_AUTO_RECALC [=] {<span class="org-keyword">DEFAULT</span>|0|1}
  | STATS_PERSISTENT [=] {<span class="org-keyword">DEFAULT</span>|0|1}
  | STATS_SAMPLE_PAGES [=] <span class="org-keyword">value</span>
  | TABLESPACE tablespace_name [STORAGE {DISK|MEMORY|<span class="org-keyword">DEFAULT</span>}]
  | <span class="org-keyword">UNION</span> [=] (tbl_name[,tbl_name]...)
</pre>
</div>

<p>
基本示例:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-comment">-- &#28155;&#21152;&#21015;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">add</span> <span class="org-keyword">column</span> qq <span class="org-type">varchar</span>(20);
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">add</span> qq <span class="org-type">varchar</span>(20); <span class="org-comment">-- &#21487;&#20197;&#21435;&#25481; column &#20851;&#38190;&#35789;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">add</span> tel <span class="org-type">varchar</span>(20) <span class="org-keyword">after</span> gender; <span class="org-comment">-- &#25351;&#23450;&#20301;&#32622;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">add</span> (xxx <span class="org-type">int</span>, yyy <span class="org-type">int</span>);

<span class="org-comment">-- &#20462;&#25913;&#21015;</span>
<span class="org-keyword">ALTER</span> <span class="org-keyword">TABLE</span> <span class="org-function-name">t2</span> <span class="org-keyword">MODIFY</span> a TINYINT <span class="org-keyword">NOT</span> <span class="org-keyword">NULL</span>, CHANGE b c <span class="org-type">CHAR</span>(20);


<span class="org-comment">-- &#21024;&#38500;&#20027;&#38190;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> change id id <span class="org-type">int</span>; <span class="org-comment">-- &#38656;&#35201;&#23558; auto_increment &#21435;&#25481;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">drop</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span>;

<span class="org-comment">-- &#22686;&#21152;&#20027;&#38190;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">add</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span> (id);
<span class="org-comment">-- &#22686;&#21152;/&#21024;&#38500;&#22806;&#38190;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">book</span> 
   <span class="org-keyword">add</span> <span class="org-keyword">constraint</span> fk_authorid
   <span class="org-keyword">foreign</span> <span class="org-keyword">key</span> (authorid)
   <span class="org-keyword">references</span> author (authorid);
<span class="org-comment">-- &#22686;&#21152;/&#21024;&#38500;&#32034;&#24341;</span>
<span class="org-keyword">ALTER</span> <span class="org-keyword">TABLE</span> <span class="org-function-name">t2</span> <span class="org-keyword">ADD</span> INDEX (d), <span class="org-keyword">ADD</span> <span class="org-keyword">UNIQUE</span> (a);
<span class="org-comment">-- &#37325;&#21629;&#21517;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">rename</span> <span class="org-keyword">to</span> people;
</pre>
</div>
</div>
</section>
<section id="outline-container-orgd5aa2aa" class="outline-2">
<h2 id="orgd5aa2aa"><span class="section-number-2">9</span> 其他命令</h2>
</section>



<section id="outline-container-orge426756" class="outline-2">
<h2 id="orge426756"><span class="section-number-2">10</span> 存储过程</h2>
<div class="outline-text-2" id="text-10">
<div class="org-src-container">
<pre class="src src-sql"><span class="org-comment">-- &#23384;&#20648;&#36807;&#31243;&#30340;&#23450;&#20041;</span>
delimiter //                   <span class="org-comment">-- &#20351;&#29992; delimiter &#25351;&#20196;&#65292;&#23558;&#40664;&#35748;&#30340;&#20998;&#38548;&#31526;(;)&#25442;&#20026;&#25105;&#20204;&#33258;&#23450;&#20041;&#30340;&#20998;&#38548;&#31526;</span>
<span class="org-keyword">create</span> <span class="org-keyword">procedure</span> <span class="org-function-name">ppx1</span> (p <span class="org-type">int</span>)  <span class="org-comment">-- &#21019;&#24314;&#23384;&#20648;&#36807;&#31243;&#65292;&#21517;&#23383; ppx1, &#19968;&#20010;&#20837;&#21442; int &#31867;&#22411;&#30340; p</span>
<span class="org-keyword">begin</span>                          <span class="org-comment">-- &#20351;&#29992; begin &#36319; end &#23558;&#25152;&#26377;&#35821;&#21477;&#21253;&#25324;&#36215;&#26469;&#65292;&#30456;&#24403;&#20110; {}</span>
    <span class="org-keyword">set</span> @x = 0;                <span class="org-comment">-- set &#26159;&#29992;&#26469;&#23450;&#20041;&#25110;&#32773;&#35774;&#32622;&#21464;&#37327;&#30340;&#20540;&#30340;&#65292;&#29992;&#25143;&#32423;&#21035;&#30340;&#21464;&#37327;&#65292;&#38656;&#35201;&#20351;&#29992; @ &#20316;&#20026;&#21069;&#32512;</span>

    repeat                     <span class="org-comment">-- repeat .. until .. end repeat &#36825;&#26159;&#20351;&#29992;&#24490;&#29615;&#30340;&#20854;&#20013;&#19968;&#31181;&#26041;&#24335;</span>
      <span class="org-keyword">set</span> @x = @x + 1;         <span class="org-comment">-- &#22312;&#24490;&#29615;&#20307;&#20013;&#65292;&#25105;&#20204;&#23601;&#21487;&#20197;&#36827;&#34892;&#25105;&#20204;&#19981;&#26029;&#37325;&#22797;&#30340;&#19994;&#21153;&#12289;&#20107;&#24773;&#20102;</span>
    until @x &gt; p <span class="org-keyword">end</span> repeat;   <span class="org-comment">-- &#20351;&#29992; until &#34920;&#31034;&#24490;&#29615;&#32467;&#26463;&#30340;&#26465;&#20214;&#12290;&#31867;&#20284;&#20110; while &#24490;&#29615;&#20013;&#30340; break</span>
<span class="org-keyword">end</span>
delimiter ;                    <span class="org-comment">-- &#36807;&#31243;&#23450;&#20041;&#23436;&#25104;&#21518;&#65292;&#38656;&#35201;&#23558;&#20998;&#38548;&#31526;&#36824;&#21407;&#20026;&#40664;&#35748;(;)</span>

<span class="org-comment">-- &#35843;&#29992;&#23384;&#20648;&#36807;&#31243;</span>
<span class="org-keyword">call</span> ppx1(100);

<span class="org-comment">-- &#26597;&#30475;&#29992;&#25143;&#23450;&#20041;&#21464;&#37327;&#30340;&#20540;</span>
<span class="org-keyword">select</span> @x;
</pre>
</div>

<p>
求和 1-n:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">procedure</span> <span class="org-function-name">sum2</span> (y <span class="org-type">int</span>)
<span class="org-keyword">begin</span>
  <span class="org-keyword">declare</span> x <span class="org-type">int</span>;  <span class="org-comment">-- &#22768;&#26126;&#23616;&#37096;&#21464;&#37327;</span>
  <span class="org-keyword">set</span> x = 0;      <span class="org-comment">-- &#20026;&#23616;&#37096;&#21464;&#37327;&#36171;&#20540;</span>
  <span class="org-keyword">set</span> @<span class="org-builtin">sum</span> = 0;
  repeat
  <span class="org-keyword">set</span> x = x + 1;
  <span class="org-keyword">set</span> @<span class="org-builtin">sum</span> = @<span class="org-builtin">sum</span> + x;
  until x &gt;= y <span class="org-keyword">end</span> repeat;
<span class="org-keyword">end</span>

</pre>
</div>
</div>
</section>
<section id="outline-container-orgd22562b" class="outline-2">
<h2 id="orgd22562b"><span class="section-number-2">11</span> 查询练习</h2>
<div class="outline-text-2" id="text-11">
<p>
创建表:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">DROP</span> <span class="org-keyword">TABLE</span> <span class="org-function-name">IF</span> <span class="org-keyword">EXISTS</span> emp;

<span class="org-keyword">CREATE</span> <span class="org-keyword">TABLE</span> <span class="org-function-name">emp</span> (
  empno <span class="org-type">decimal</span>(4,0) <span class="org-keyword">NOT</span> <span class="org-keyword">NULL</span>,
  ename <span class="org-type">varchar</span>(10) <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>,
  job <span class="org-type">varchar</span>(9) <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>,
  mgr <span class="org-type">decimal</span>(4,0) <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>,
  hiredate <span class="org-type">date</span> <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>,
  sal <span class="org-type">decimal</span>(7,2) <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>,
  comm <span class="org-type">decimal</span>(7,2) <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>,
  deptno <span class="org-type">decimal</span>(2,0) <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>
);

<span class="org-keyword">DROP</span> <span class="org-keyword">TABLE</span> <span class="org-function-name">IF</span> <span class="org-keyword">EXISTS</span> dept;

<span class="org-keyword">CREATE</span> <span class="org-keyword">TABLE</span> <span class="org-function-name">dept</span> (
  deptno <span class="org-type">decimal</span>(2,0) <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>,
  dname <span class="org-type">varchar</span>(14) <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>,
  loc <span class="org-type">varchar</span>(13) <span class="org-keyword">default</span> <span class="org-keyword">NULL</span>
);

<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7369'</span>,<span class="org-string">'SMITH'</span>,<span class="org-string">'CLERK'</span>,<span class="org-string">'7902'</span>,<span class="org-string">'1980-12-17'</span>,<span class="org-string">'800.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'20'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7499'</span>,<span class="org-string">'ALLEN'</span>,<span class="org-string">'SALESMAN'</span>,<span class="org-string">'7698'</span>,<span class="org-string">'1981-02-20'</span>,<span class="org-string">'1600.00'</span>,<span class="org-string">'300.00'</span>,<span class="org-string">'30'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7521'</span>,<span class="org-string">'WARD'</span>,<span class="org-string">'SALESMAN'</span>,<span class="org-string">'7698'</span>,<span class="org-string">'1981-02-22'</span>,<span class="org-string">'1250.00'</span>,<span class="org-string">'500.00'</span>,<span class="org-string">'30'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7566'</span>,<span class="org-string">'JONES'</span>,<span class="org-string">'MANAGER'</span>,<span class="org-string">'7839'</span>,<span class="org-string">'1981-04-02'</span>,<span class="org-string">'2975.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'20'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7654'</span>,<span class="org-string">'MARTIN'</span>,<span class="org-string">'SALESMAN'</span>,<span class="org-string">'7698'</span>,<span class="org-string">'1981-09-28'</span>,<span class="org-string">'1250.00'</span>,<span class="org-string">'1400.00'</span>,<span class="org-string">'30'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7698'</span>,<span class="org-string">'BLAKE'</span>,<span class="org-string">'MANAGER'</span>,<span class="org-string">'7839'</span>,<span class="org-string">'1981-05-01'</span>,<span class="org-string">'2850.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'30'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7782'</span>,<span class="org-string">'CLARK'</span>,<span class="org-string">'MANAGER'</span>,<span class="org-string">'7839'</span>,<span class="org-string">'1981-06-09'</span>,<span class="org-string">'2450.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'10'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7788'</span>,<span class="org-string">'SCOTT'</span>,<span class="org-string">'ANALYST'</span>,<span class="org-string">'7566'</span>,<span class="org-string">'1982-12-09'</span>,<span class="org-string">'3000.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'20'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7839'</span>,<span class="org-string">'KING'</span>,<span class="org-string">'PRESIDENT'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'1981-11-17'</span>,<span class="org-string">'5000.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'10'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7844'</span>,<span class="org-string">'TURNER'</span>,<span class="org-string">'SALESMAN'</span>,<span class="org-string">'7698'</span>,<span class="org-string">'1981-09-08'</span>,<span class="org-string">'1500.00'</span>,<span class="org-string">'0.00'</span>,<span class="org-string">'30'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7876'</span>,<span class="org-string">'ADAMS'</span>,<span class="org-string">'CLERK'</span>,<span class="org-string">'7788'</span>,<span class="org-string">'1983-01-12'</span>,<span class="org-string">'1100.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'20'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7900'</span>,<span class="org-string">'JAMES'</span>,<span class="org-string">'CLERK'</span>,<span class="org-string">'7698'</span>,<span class="org-string">'1981-12-03'</span>,<span class="org-string">'950.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'30'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7902'</span>,<span class="org-string">'FORD'</span>,<span class="org-string">'ANALYST'</span>,<span class="org-string">'7566'</span>,<span class="org-string">'1981-12-03'</span>,<span class="org-string">'3000.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'20'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> emp <span class="org-keyword">VALUES</span> (<span class="org-string">'7934'</span>,<span class="org-string">'MILLER'</span>,<span class="org-string">'CLERK'</span>,<span class="org-string">'7782'</span>,<span class="org-string">'1982-01-23'</span>,<span class="org-string">'1300.00'</span>,<span class="org-keyword">NULL</span>,<span class="org-string">'10'</span>);

<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> dept <span class="org-keyword">VALUES</span> (<span class="org-string">'10'</span>,<span class="org-string">'ACCOUNTING'</span>,<span class="org-string">'NEW YORK'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> dept <span class="org-keyword">VALUES</span> (<span class="org-string">'20'</span>,<span class="org-string">'RESEARCH'</span>,<span class="org-string">'DALLAS'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> dept <span class="org-keyword">VALUES</span> (<span class="org-string">'30'</span>,<span class="org-string">'SALES'</span>,<span class="org-string">'CHICAGO'</span>);
<span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> dept <span class="org-keyword">VALUES</span> (<span class="org-string">'40'</span>,<span class="org-string">'OPERATIONS'</span>,<span class="org-string">'BOSTON'</span>);
</pre>
</div>

<p>
1:
</p>
<ul class="org-ul">
<li>在芝加哥工作的人中，谁的工资最高</li>
<li>查询每个部门下有多少员工</li>
<li>查询除去 salesman 所有平均工资超过 1500 的部门</li>
<li>查询在 new york 工作的所有员工的姓名，部门名称和工资信息</li>
<li>查询姓名为 King 的员工的编号，名称跟部门</li>
<li>查询各种工作的最低工资</li>
<li>查询工龄大于10年的所有员工信息</li>
<li>查询每个部门员工数量，平均工资和平均工作年限</li>
<li>统计各部门每个工种的人数，平均工资。</li>
<li>查询从事同一种工作但不属于同一部门的员工信息。</li>
<li>查询所有员工工资都大于1000的部门的信息及员工信息</li>
<li>查询入职日期早于其直接上级的所有员工信息。</li>
<li>列出雇员中（除去mgr为空的人)工资第二高的人。</li>
<li>列出1981年来公司所有员工的总收入（包括sal和comm）</li>
</ul>

<p>
2:
</p>
<ul class="org-ul">
<li>查询工资为 2500 到 4000 的人的数量（用不同方式查询）</li>
<li>查询部门编号为 10 和 30 的所有人（用不同方式查询）</li>
<li>查询部门编号为 10 和 30 中名字中不含有 ‘C’ 的所有人</li>
<li>查询部门编号为 10 和 30 中名字首字母之外不含有 ‘C’ 的所有人</li>
<li>查询部门编号为 10 和 30 中所有的经理以及名字首字母之外不含有 ‘C’ 的所有人</li>
<li>查询纽约和芝加哥地区所有的经理以及名字首字母之外不含有 ‘C’ 的所有人</li>
<li>查询纽约和芝加哥地区所有的经理以及顶头上司名字的首字母之外不含有 ‘C’ 的所有人</li>
<li>查询每个人的工资等级</li>
<li>查询每个部门的平均工资的等级</li>
</ul>

<p>
3:
</p>
<ul class="org-ul">
<li>查询每个组最高工资的那些人</li>
<li><p>
有下面一个表，写一条 sql 语句计算男女之差
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">gender</th>
<th scope="col" class="org-right">number</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">男</td>
<td class="org-right">46</td>
</tr>

<tr>
<td class="org-left">女</td>
<td class="org-right">10</td>
</tr>
</tbody>
</table></li>
<li><p>
给 emp 中的人加工资，请写出相关语句:
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">条件</th>
<th scope="col" class="org-right">加多少</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">1000元以下</td>
<td class="org-right">50%</td>
</tr>

<tr>
<td class="org-left">2000元以下</td>
<td class="org-right">30%</td>
</tr>

<tr>
<td class="org-left">3000元以下</td>
<td class="org-right">20%</td>
</tr>

<tr>
<td class="org-left">其他</td>
<td class="org-right">5%</td>
</tr>
</tbody>
</table></li>
<li>给 emp 中的人加工资，如上。但 1981/5/1 之后来的所有人，只加 2%, 请写出语句。</li>
<li>计算你们从入学到现在过了多少个周末</li>
<li>计算你们从现在到毕业还有多少天，还有多少个周末</li>
<li>计算你们在学校的时间内，每天花费多少钱</li>
</ul>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 某某人</p>
<p class="date">Created: 2018-09-10 Mon 00:30</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
